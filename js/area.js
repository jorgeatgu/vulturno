const vulturno=()=>{const t=window.innerWidth>0?window.innerWidth:screen.width;margin=t>544?{top:16,right:16,bottom:24,left:48}:{top:16,right:16,bottom:24,left:32};let e=0,a=0;const n=d3.select(".chart-vulturno"),o=n.select("svg");let r={};let s,i,c;const l=n.append("div").attr("class","tooltip tooltip-temp").style("opacity",0),m=d3.bisector(t=>t.year).left;console.log(m);const d=(t,e)=>{r.count.x.range([0,t]),r.count.y.range([e,0])},p=t=>{const o=d3.axisBottom(r.count.x).tickPadding(5).tickFormat(d3.format("d")).ticks(13);t.select(".axis-x").attr("transform","translate(0,"+a+")").transition().duration(300).ease(d3.easeLinear).call(o);const i=d3.axisLeft(r.count.y).tickPadding(5).tickFormat(t=>t+"ºC").tickSize(-e).ticks(6);t.select(".axis-y").transition().duration(300).ease(d3.easeLinear).call(i);const c=t.select(".focus"),d=t.select(".overlay");c.select(".x-hover-line").attr("y2",a),d.attr("width",e+margin.left+margin.right).attr("height",a).on("mouseover",function(){c.style("display",null)}).on("mouseout",function(){c.style("display","none"),l.style("opacity",0)}).on("mousemove",function(){n.node().offsetWidth;const t=r.count.x.invert(d3.mouse(this)[0]),e=m(s,t,1),a=s[e-1],o=s[e],i=t-a.fecha>o.fecha-t?o:a;l.style("opacity",1).html(`<p class="tooltip-media-texto">En <strong>${i.year}</strong> la temperatura media fue de <strong>${i.temp} ºC</strong>.<p/>`),c.select(".x-hover-line").attr("transform",`translate(${r.count.x(i.fecha)},0)`)})};function u(t){const i=n.node().offsetWidth;e=i-margin.left-margin.right,a=500-margin.top-margin.bottom,o.attr("width",i).attr("height",500);const c="translate("+margin.left+","+margin.top+")",l=o.select(".chart-vulturno-container");l.attr("transform",c);const m=d3.area().x(t=>r.count.x(t.year)).y0(a).y1(t=>r.count.y(t.temp));d(e,a);const u=n.select(".chart-vulturno-container-bis"),y=u.selectAll(".area").data([s]),x=y.enter().append("path").attr("class","area area-vulturno"),g=u.selectAll(".circlesBig").remove().exit().data(s),f=g.enter().append("circle").attr("class","circlesBig"),h=u.selectAll(".circles").remove().exit().data(s),v=h.enter().append("circle").attr("class","circles");y.merge(x).transition().duration(600).ease(d3.easeLinear).attr("d",m),h.merge(v).attr("cx",t=>r.count.x(t.year)).attr("cy",0).transition().delay(function(t,e){return 10*e}).duration(300).ease(d3.easeLinear).attr("cx",t=>r.count.x(t.year)).attr("cy",t=>r.count.y(t.temp)).attr("r",3),f.merge(g).attr("cx",t=>r.count.x(t.year)).attr("cy",0).transition().delay(function(t,e){return 10*e}).duration(300).ease(d3.easeLinear).attr("cx",t=>r.count.x(t.year)).attr("cy",t=>r.count.y(t.temp)).attr("r",6),p(l)}function y(t){d3.csv("csv/"+t+".csv",(t,n)=>{(s=n).forEach(t=>{t.temp=+t.temp,t.year=t.year,t.fecha=+t.year,t.tempmax=+t.tempmax,t.yearmax=t.yearmax,t.tempmin=+t.tempmin,t.yearmin=t.yearmin}),r.count.x.range([0,e]),r.count.y.range([a,0]);const o=d3.scaleTime().domain([d3.min(s,t=>t.year),d3.max(s,t=>t.year)]),l=d3.scaleLinear().domain([d3.min(s,t=>t.temp-1),d3.max(s,t=>t.temp+2)]);r.count={x:o,y:l},u(),i.data(s).html(function(t){return"<p class='tooltip-media-texto'>La máxima fue de <strong>"+d3.max(s,t=>t.tempmax)+"ºC</strong> en <strong>"+t.yearmax}),c.data(s).html(function(t){return"<p class='tooltip-media-texto'>La mínima fue de <strong>"+d3.min(s,t=>t.tempmin)+"ºC</strong> en <strong>"+t.yearmin})})}window.addEventListener("resize",()=>{const t=d3.select("#select-city").property("value");d3.csv("csv/"+t+".csv",(t,e)=>{s=e,u()})}),d3.csv("csv/Segovia.csv",(t,e)=>{t?console.log(t):((s=e).forEach(t=>{t.year=t.year,t.temp=t.temp,t.fecha=+t.year}),(()=>{const t=o.select(".chart-vulturno-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","chart-vulturno-container-bis"),t.append("rect").attr("class","overlay"),t.append("g").attr("class","focus").style("display","none").append("line").attr("class","x-hover-line hover-line").attr("y1",0),t.select(".focus").append("text").attr("class","text-focus")})(),(()=>{const t=d3.scaleTime().domain([d3.min(s,t=>t.year),d3.max(s,t=>t.year)]),e=d3.scaleLinear().domain([d3.min(s,t=>t.temp-1),20]);r.count={x:t,y:e}})(),u(),(t=>{i=n.append("div").attr("class","tooltip tooltip-media-anual-maxima").attr("id","tooltip-max"),c=n.append("div").attr("class","tooltip tooltip-media-anual-minima"),i.data(s).html(function(t){return"<p class='tooltip-media-texto'>La máxima fue de <strong>"+d3.max(s,t=>t.tempmax)+"ºC</strong> en <strong>"+t.yearmax}),c.data(s).html(function(t){return"<p class='tooltip-media-texto'>La mínima fue de <strong>"+d3.min(s,t=>t.tempmin)+"ºC</strong> en <strong>"+t.yearmin})})(),mes="Segovia",y(mes))}),d3.csv("csv/stations.csv",(t,e)=>{if(t)console.log(t);else{s=e;const t=d3.nest().key(t=>t.Name).entries(s),a=d3.select("#select-city");a.selectAll("option").data(t).enter().append("option").attr("value",t=>t.key).text(t=>t.key),a.on("change",function(){y(d3.select(this).property("value"))})}})};vulturno(),new SlimSelect({select:"#select-city",searchPlaceholder:"Busca tu ciudad"});
const areaInput=()=>{const t={top:16,right:16,bottom:24,left:48};let e=0,a=0;const n=d3.select(".chart-vulturno"),c=n.select("svg");let s={};let r;const o=(t,e)=>{s.count.x.range([0,t]),s.count.y.range([e,0])},i=t=>{const n=d3.axisBottom(s.count.x).tickPadding(5).tickFormat(d3.format("d")).ticks(13);t.select(".axis-x").attr("transform","translate(0,"+a+")").transition().duration(300).ease(d3.easeLinear).call(n);const c=d3.axisLeft(s.count.y).tickPadding(5).tickFormat(t=>t+"ÂºC").tickSize(-e).ticks(6);t.select(".axis-y").transition().duration(300).ease(d3.easeLinear).call(c)};function l(l){const d=n.node().offsetWidth;e=d-t.left-t.right,a=400-t.top-t.bottom,c.attr("width",d).attr("height",400);const u="translate("+t.left+","+t.top+")",m=c.select(".chart-vulturno-container");m.attr("transform",u);const p=d3.area().x(t=>s.count.x(t.year)).y0(a).y1(t=>s.count.y(t.temp));o(e,a);const y=n.select(".chart-vulturno-container-bis"),x=y.selectAll(".area").data([r]),v=x.enter().append("path").attr("class","area area-vulturno"),g=y.selectAll(".circles").remove().exit().data(r),f=g.enter().append("circle").attr("class","circles").attr("fill","#921d5d").attr("opacity",1);x.merge(v).transition().duration(600).ease(d3.easeLinear).attr("d",p),g.merge(f).attr("cx",t=>s.count.x(t.year)).attr("cy",0).transition().delay(function(t,e){return 10*e}).duration(300).attr("cx",t=>s.count.x(t.year)).attr("cy",t=>s.count.y(t.temp)).attr("r",3),i(m)}window.addEventListener("resize",()=>{const t=d3.select("#select-city").property("value");d3.csv("csv/"+t+".csv",(t,e)=>{r=e,l()})}),d3.csv("csv/Albacete.csv",(t,e)=>{t?console.log(t):((r=e).forEach(t=>{t.year=t.year,t.temp=t.temp}),(()=>{const t=c.select(".chart-vulturno-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","chart-vulturno-container-bis")})(),(()=>{const t=d3.scaleTime().domain([d3.min(r,t=>t.year),d3.max(r,t=>t.year)]),e=d3.scaleLinear().domain([d3.min(r,t=>t.temp-1),20]);s.count={x:t,y:e}})(),l())}),d3.csv("csv/stations.csv",(t,n)=>{if(t)console.log(t);else{r=n;const t=d3.nest().key(t=>t.Name).entries(r);console.log(t);const c=d3.select("#select-city");c.selectAll("option").data(t).enter().append("option").attr("value",t=>t.key).text(t=>t.key),c.on("change",function(){!function(t){d3.csv("csv/"+t+".csv",(t,n)=>{(r=n).forEach(t=>{t.temp=+t.temp,t.year=t.year}),s.count.x.range([0,e]),s.count.y.range([a,0]);const c=d3.scaleTime().domain([d3.min(r,t=>t.year),d3.max(r,t=>t.year)]),o=d3.scaleLinear().domain([d3.min(r,t=>t.temp-1),d3.max(r,t=>t.temp+2)]);s.count={x:c,y:o},l()})}(d3.select(this).property("value"))})}})};areaInput(),new SlimSelect({select:"#select-city"});